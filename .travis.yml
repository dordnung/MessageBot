language: cpp

sudo: required

services:
  - docker
  
addons:
    apt:
        packages:
            - docker-ce

env:
    matrix:
        - SMBRANCH=1.8-dev
        - SMBRANCH=1.9-dev
        - SMBRANCH=master
        
before_script:
    - mkdir build
    - docker build -t messagebot .

script:
    - docker run --env SMBRANCH=$SMBRANCH --env MESSAGEBOT_DIR=/build --env BUILD_DIR=/build/build -v $(pwd):/build  messagebot bash build.sh
    
deploy:
    - provider: releases
      skip_cleanup: true
      api_key:
          secure: oFTCf0Y9VquXXgTcW8oFPeFX0xRNIxUBV2ePVbakPSei8BBCUkn7gRv5V34mnvYCHjx1xdffEoB3X0m36uZQ1demfRysTrpNOcqRDcNIR67ttm/JD0uibiauYA/HSHbVAM8QiEq1gIC4VOswUyh6I1MhcWJsWy6tcBbSAqaPvpstCL5oevBkEbEjn+SL4Q7iFl520253VTJMFUoLUb9STHXg6cA7oz17BYZ8cg4RE26AQ9Ptp7eeoqKjBVVVboiHRJ9c9eg+CKk9fEFiOUcUu8LmhQLx0hEDnVxinqbMSJlUcL6nKrZ4AyliwqGqwBwHhppVubWloGG1IosrudNk+wFt7Lz4j7PLsOgQ39dd5jdLPNaJGdDDhLenp3pj389vkPqp0yHHIXwVfJmXrav9rwMBcz+/qfhJZ/cpj7Kg0CsBcrSAhiwN7MKOpWuCDSbx/gkp8iqsls0/k2Plthp3S7pl+nEbLmCOHldq5Z0eMnqA+ftm8Q0Ir2pD8W3X9iErNqdhADq8G5AY5/Ii9I8kYzd8SHQvVqp7mVR70WwYLBrGPzRYUYYPRaARJ/9khP3F/cKjMaQnqnVSqUhyPowesxDYXI/XCUHCj2Ng6tada1wd5OkINUp67Lu9yXIbI2B1magvJD3+ShR2vuOFpa3Wi+DqMnMCOPWSd3pAI2qQvUI=
      file:
          - Release/messagebot.ext.so
      on:
          condition: "$SMBRANCH = 1.9-dev"
          repo: dordnung/MessageBot
          all_branches: true